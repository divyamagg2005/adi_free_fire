<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Fire AI Photo Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background inspired by gaming */
        }
        .container {
            max-width: 640px;
            margin: auto;
        }
        #image-preview {
            max-width: 100%;
            height: auto;
            display: none; /* Hidden by default */
        }
        .api-key-section {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid #ffd700;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen p-4">

    <div class="bg-gray-800 rounded-xl shadow-lg p-6 w-full max-w-lg space-y-6 border border-yellow-500">
        <h1 class="text-3xl font-bold text-center text-yellow-400">Free Fire AI Photo Generator</h1>

        <!-- API Key Input Section -->
        <div class="api-key-section">
            <label for="api-key-input" class="block text-sm font-medium text-yellow-400 mb-2">
                API Key (Required)
            </label>
            <input 
                type="password" 
                id="api-key-input" 
                class="w-full p-3 text-sm text-white bg-gray-700 rounded-lg border border-gray-600 focus:ring-yellow-500 focus:border-yellow-500 transition-all" 
                placeholder="Enter your Gemini API key here..."
            >
            <p class="text-xs text-gray-400 mt-2">
                Get your free API key from <a href="https://aistudio.google.com/" target="_blank" class="text-yellow-400 hover:underline">Google AI Studio</a>
            </p>
        </div>

        <div class="space-y-4">
            <textarea id="prompt-input" rows="4" class="w-full p-4 text-sm text-white bg-gray-700 rounded-lg border border-gray-600 focus:ring-yellow-500 focus:border-yellow-500 transition-all" placeholder="e.g., 'A cinematic photo of DJ Alok on the Bermuda map, with a glowing aura'..."></textarea>

            <button id="generate-button" class="w-full py-3 px-6 bg-red-600 text-white font-semibold rounded-lg shadow-lg hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50">
                Generate Photo
            </button>
        </div>

        <div id="status-message" class="text-center text-gray-400 italic"></div>

        <div id="image-container" class="bg-gray-700 rounded-lg flex items-center justify-center min-h-64 overflow-hidden shadow-inner border border-dashed border-gray-600">
            <img id="image-preview" src="" alt="Generated AI Photo" class="rounded-lg shadow-md w-full">
            <p id="placeholder-text" class="text-gray-500 p-4 text-center">Your Free Fire photo will appear here.</p>
        </div>
    </div>

    <script>
        const apiKeyInput = document.getElementById('api-key-input');
        const promptInput = document.getElementById('prompt-input');
        const generateButton = document.getElementById('generate-button');
        const statusMessage = document.getElementById('status-message');
        const imagePreview = document.getElementById('image-preview');
        const placeholderText = document.getElementById('placeholder-text');

        // Load saved API key
        const savedApiKey = localStorage.getItem('gemini-api-key');
        if (savedApiKey) {
            apiKeyInput.value = savedApiKey;
        }

        // Save API key when changed
        apiKeyInput.addEventListener('change', () => {
            if (apiKeyInput.value.trim()) {
                localStorage.setItem('gemini-api-key', apiKeyInput.value.trim());
            }
        });
        
        generateButton.addEventListener('click', async () => {
            const apiKey = apiKeyInput.value.trim();
            const prompt = promptInput.value.trim();

            // Validation
            if (!apiKey) {
                statusMessage.textContent = 'Please enter your API key first.';
                return;
            }

            if (!prompt) {
                statusMessage.textContent = 'Please enter a description to generate a photo.';
                return;
            }

            // Show loading state
            statusMessage.textContent = 'Generating Free Fire photo, please wait...';
            generateButton.disabled = true;
            generateButton.textContent = 'Generating...';
            imagePreview.style.display = 'none';
            placeholderText.style.display = 'block';

            try {
                // Save API key
                localStorage.setItem('gemini-api-key', apiKey);

                // Enhanced Free Fire prompt
                const enhancedPrompt = `A photo of a Garena Free Fire game character in the Free Fire game art style, based on the following description: ${prompt}`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-preview-image-generation:generateContent`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-goog-api-key': apiKey
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: enhancedPrompt
                            }]
                        }],
                        generationConfig: {
                            responseModalities: ["TEXT", "IMAGE"]
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `API Error: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                
                // Look for image in the response (Gemini format)
                let imageFound = false;
                if (result.candidates && result.candidates.length > 0) {
                    const candidate = result.candidates[0];
                    if (candidate.content && candidate.content.parts) {
                        for (const part of candidate.content.parts) {
                            if (part.inlineData && part.inlineData.data) {
                                const imageUrl = `data:${part.inlineData.mimeType};base64,${part.inlineData.data}`;
                                imagePreview.src = imageUrl;
                                imagePreview.style.display = 'block';
                                placeholderText.style.display = 'none';
                                statusMessage.textContent = 'Photo generated successfully!';
                                imageFound = true;
                                break;
                            }
                        }
                    }
                }

                if (!imageFound) {
                    throw new Error('No image data found in the response.');
                }

            } catch (error) {
                console.error('Failed to generate image:', error);
                statusMessage.textContent = `Error: ${error.message}`;
                placeholderText.style.display = 'block';
                
                // Handle specific error cases
                if (error.message.includes('API_KEY_INVALID')) {
                    statusMessage.textContent = 'Invalid API key. Please check your Gemini API key.';
                } else if (error.message.includes('PERMISSION_DENIED')) {
                    statusMessage.textContent = 'Access denied. Make sure your API key has the right permissions.';
                } else if (error.message.includes('QUOTA_EXCEEDED')) {
                    statusMessage.textContent = 'API quota exceeded. Please wait or check your billing.';
                }
            } finally {
                // Reset button state
                generateButton.disabled = false;
                generateButton.textContent = 'Generate Photo';
            }
        });
    </script>
</body>
</html>
